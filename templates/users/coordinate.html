{% extends "users/base.html" %}
{% block content %}
    <!-- Your existing profile content goes here -->
    <!-- Add the button and JavaScript code here -->
    <div class="p-3 ">
        <div class="bg1 w-25 m-auto rounded width12 width1"  >
            <div class="d-flex p-3 justify-content-center form-content w--rem-28" >
                <div class="">
        {% comment %} <div class="modal-body"> {% endcomment %}
            <form method="post">
                <div class="">
                    {% csrf_token %}
                    {% for field in form %}
                    <div class="form-group">
                        {{ field.label }}:
                        {{ field}}
                        <div class="w-50 mx-2">
                        <div class="">
                            <label class="small mb-1"></label>
                        </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <button type="submit" class="btn btn-primary" >
                    Add the Expense
                </button> 
                <button class = "btn btn-primary" id="update-coordinates-btn">Update My Coordinates</button>
            </form>
        {% comment %}   </div> {% endcomment %}
    </div>
    </div>
    </div>
    </div>
    
    <script>
    document.getElementById('update-coordinates-btn').addEventListener('click', function() {
        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                fetch('/update-coordinates/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',  // Include CSRF token
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `latitude=${latitude}&longitude=${longitude}`,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Coordinates updated successfully') {
                        alert('Coordinates updated successfully');
                    } else {
                        alert('Failed to update coordinates');
                    }
                });
            });
        } else {
            alert('Geolocation is not available in your browser.');
        }
    });
    </script>

{% endblock %}